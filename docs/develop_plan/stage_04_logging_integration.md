# Этап 4: Интеграция с системой логирования

## Цель этапа
Интегрировать модуль агрегации операций с существующей системой логирования (`LoggerManager`).

## Задачи

### 4.1 Создание агрегированного логгера
- Создать отдельный логгер для агрегированных операций:
  - Имя: `solid_state_kinetics.operations`
  - Отдельный файл: `logs/aggregated_operations.log`
  - Независимые настройки уровня логирования
- Интеграция с `LoggerManager.get_logger()`

### 4.2 Конфигурация файла агрегированных логов
- Настройка RotatingFileHandler для `aggregated_operations.log`:
  - Ротация по размеру (аналогично основному логу)
  - Количество backup файлов
  - Кодировка UTF-8
- Отдельный форматтер для агрегированных логов

### 4.3 Расширение LoggerManager
- Модификация `LoggerManager.configure_logging()` для поддержки:
  - Создания агрегированного логгера
  - Настройки отдельного handler'а
  - Конфигурирования уровня логирования
- Альтернативный подход: программное добавление handler'а после инициализации

### 4.4 Создание OperationLogger класса
- Основной класс для работы с агрегированными логами:
  - `log_operation(operation_log)` - запись операции в файл
  - `format_operation_log(operation_log)` - форматирование операции
  - Интеграция с `TableFormatter`
- Singleton pattern для единственного экземпляра логгера

### 4.5 Интеграция с декоратором
- Модификация декоратора `@operation` для использования `OperationLogger`
- Автоматическая запись завершённых операций в агрегированный лог
- Обработка ошибок записи (не должны влиять на основную логику)

### 4.6 Обработка ошибок логирования
- Graceful handling ошибок записи в файл:
  - Проблемы с файловой системой
  - Недостаток места на диске
  - Проблемы с правами доступа
- Fallback на стандартный логгер при сбоях агрегированного логирования

## Критерии готовности
- [ ] Создаётся отдельный файл `logs/aggregated_operations.log`
- [ ] Логгер корректно интегрирован с `LoggerManager`
- [ ] Агрегированные логи записываются в правильном формате
- [ ] Ротация файла работает корректно
- [ ] Ошибки логирования не прерывают выполнение операций
- [ ] Конфигурация логирования не нарушает существующую систему

## Файлы для создания/изменения
- `src/core/log_aggregator/operation_logger.py` (основной класс)
- `src/core/logger_config.py` (расширение LoggerManager)
- `src/core/log_aggregator/__init__.py` (экспорт публичных классов)

## Примечания
Важные моменты:
- Обеспечить обратную совместимость с текущим логированием
- Не нарушать существующую иерархию логгеров
- Предусмотреть возможность отключения агрегированного логирования
- Использовать те же принципы безопасности, что и в основной системе логирования
