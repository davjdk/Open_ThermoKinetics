# –≠—Ç–∞–ø 9: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

## –¶–µ–ª—å —ç—Ç–∞–ø–∞
–ü—Ä–æ–≤–µ—Å—Ç–∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π, –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã.

## –ó–∞–¥–∞—á–∏ —ç—Ç–∞–ø–∞

### 9.1 –ú–æ–¥—É–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ `@operation`
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `OperationLogger`
- –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

### 9.2 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤

### 9.3 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ò–∑–º–µ—Ä–µ–Ω–∏–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏

### 9.4 –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å PyQt —Å–∏–≥–Ω–∞–ª–∞–º–∏ –∏ —Å–ª–æ—Ç–∞–º–∏
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º
- –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ API
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏

## –ù–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤

### 9.5 –¢–µ—Å—Ç—ã –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ @operation
```python
import pytest
import time
from unittest.mock import Mock, patch
from src.core.logger_handler import operation, get_operation_logger

class TestOperationDecorator:
    """–¢–µ—Å—Ç—ã –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ @operation"""
    
    def test_basic_operation_decoration(self):
        """–¢–µ—Å—Ç –±–∞–∑–æ–≤–æ–≥–æ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏"""
        mock_logger = Mock()
        
        with patch('src.core.logger_handler.get_operation_logger', return_value=mock_logger):
            @operation
            def test_operation():
                return "success"
            
            result = test_operation()
            
            assert result == "success"
            mock_logger.start_operation.assert_called_once()
            mock_logger.end_operation.assert_called_once_with(status="SUCCESS")
    
    def test_operation_with_exception(self):
        """–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏"""
        mock_logger = Mock()
        
        with patch('src.core.logger_handler.get_operation_logger', return_value=mock_logger):
            @operation
            def failing_operation():
                raise ValueError("Test error")
            
            with pytest.raises(ValueError, match="Test error"):
                failing_operation()
            
            mock_logger.start_operation.assert_called_once()
            mock_logger.end_operation.assert_called_once_with(
                status="ERROR",
                error_info={
                    "type": "ValueError",
                    "message": "Test error",
                    "handled": True
                }
            )
    
    def test_nested_operations(self):
        """–¢–µ—Å—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π"""
        mock_logger = Mock()
        
        with patch('src.core.logger_handler.get_operation_logger', return_value=mock_logger):
            @operation
            def parent_operation():
                child_operation()
                return "parent_done"
            
            @operation
            def child_operation():
                return "child_done"
            
            result = parent_operation()
            
            assert result == "parent_done"
            assert mock_logger.start_operation.call_count == 2
            assert mock_logger.end_operation.call_count == 2
    
    def test_operation_with_custom_type(self):
        """–¢–µ—Å—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º —Ç–∏–ø–æ–º"""
        mock_logger = Mock()
        
        with patch('src.core.logger_handler.get_operation_logger', return_value=mock_logger):
            @operation(operation_type="CUSTOM_OPERATION")
            def custom_operation():
                return "custom"
            
            result = custom_operation()
            
            assert result == "custom"
            mock_logger.start_operation.assert_called_once_with("CUSTOM_OPERATION")
    
    def test_pyqt_slot_compatibility(self):
        """–¢–µ—Å—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å PyQt —Å–ª–æ—Ç–∞–º–∏"""
        from PyQt6.QtCore import pyqtSlot, QObject
        
        class TestWidget(QObject):
            @operation
            @pyqtSlot()
            def slot_method(self):
                return "slot_result"
        
        widget = TestWidget()
        result = widget.slot_method()
        
        assert result == "slot_result"
        assert hasattr(widget.slot_method, '__pyqtSignature__')
```

### 9.6 –¢–µ—Å—Ç—ã OperationLogger
```python
class TestOperationLogger:
    """–¢–µ—Å—Ç—ã –∫–ª–∞—Å—Å–∞ OperationLogger"""
    
    def setup_method(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º"""
        self.logger = OperationLogger()
    
    def test_operation_lifecycle(self):
        """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏"""
        # –ù–∞—á–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
        self.logger.start_operation("TEST_OPERATION")
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
        current = self.logger.get_current_operation()
        assert current is not None
        assert current['operation_name'] == "TEST_OPERATION"
        assert 'start_time' in current
        
        # –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫—É
        self.logger.add_metric("test_metric", 42)
        
        # –ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
        self.logger.end_operation(status="SUCCESS")
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞
        assert self.logger.get_current_operation() is None
    
    def test_nested_operation_aggregation(self):
        """–¢–µ—Å—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π"""
        # –ù–∞—á–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é –æ–ø–µ—Ä–∞—Ü–∏—é
        self.logger.start_operation("PARENT_OPERATION")
        
        # –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫—É –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π
        self.logger.add_metric("parent_metric", 1)
        
        # –ù–∞—á–∞—Ç—å –¥–æ—á–µ—Ä–Ω—é—é –æ–ø–µ—Ä–∞—Ü–∏—é
        self.logger.start_operation("CHILD_OPERATION")
        self.logger.add_metric("child_metric", 2)
        self.logger.end_operation("SUCCESS")
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –∫ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–π
        current = self.logger.get_current_operation()
        assert current['operation_name'] == "PARENT_OPERATION"
        
        # –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é
        self.logger.end_operation("SUCCESS")
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≥—Ä–µ–≥–∞—Ü–∏—é –º–µ—Ç—Ä–∏–∫
        # (–∑–¥–µ—Å—å –Ω—É–∂–Ω–∞ —Ä–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
    
    def test_error_handling(self):
        """–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫"""
        self.logger.start_operation("ERROR_OPERATION")
        
        error_info = {
            "type": "ValueError",
            "message": "Test error",
            "traceback": "mock traceback"
        }
        
        self.logger.end_operation(status="ERROR", error_info=error_info)
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—à–∏–±–∫–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞
        # (–∑–¥–µ—Å—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ –ª–æ–≥–∏ –∏–ª–∏ –≤—ã–∑–æ–≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞)
    
    def test_thread_safety(self):
        """–¢–µ—Å—Ç –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"""
        import threading
        import time
        
        results = []
        
        def worker_thread(thread_id):
            self.logger.start_operation(f"THREAD_OPERATION_{thread_id}")
            time.sleep(0.1)  # –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã
            self.logger.add_metric("thread_id", thread_id)
            self.logger.end_operation("SUCCESS")
            results.append(thread_id)
        
        # –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ—Ç–æ–∫–æ–≤
        threads = []
        for i in range(5):
            thread = threading.Thread(target=worker_thread, args=(i,))
            threads.append(thread)
            thread.start()
        
        # –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        for thread in threads:
            thread.join()
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        assert len(results) == 5
        assert set(results) == {0, 1, 2, 3, 4}
```

### 9.7 –¢–µ—Å—Ç—ã Rich —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```python
class TestRichFormatting:
    """–¢–µ—Å—Ç—ã —Å–∏—Å—Ç–µ–º—ã Rich —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü"""
    
    def test_rich_operation_table(self):
        """–¢–µ—Å—Ç Rich —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏"""
        from src.core.rich_formatter import RichOperationFormatter
        from io import StringIO
        from rich.console import Console
        
        # –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Å–æ–ª—å —Å –∑–∞—Ö–≤–∞—Ç–æ–º –≤—ã–≤–æ–¥–∞
        output = StringIO()
        console = Console(file=output, force_terminal=True)
        
        formatter = RichOperationFormatter()
        formatter.console = console
        
        operation_data = {
            "operation_name": "ADD_REACTION",
            "display_name": "Add Reaction",
            "status": "SUCCESS",
            "duration": 0.523,
            "call_count": 1,
            "nested_operations": 3,
            "files_modified": 2,
            "thread_id": "MainThread"
        }
        
        formatter.format_operation_summary(operation_data)
        result = output.getvalue()
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        assert "üîÑ OPERATION SUMMARY" in result
        assert "Add Reaction" in result
        assert "‚úÖ SUCCESS" in result
        assert "0.523s" in result
        assert "MainThread" in result
    
    def test_rich_error_panel(self):
        """–¢–µ—Å—Ç Rich –ø–∞–Ω–µ–ª–∏ –æ—à–∏–±–æ–∫"""
        from src.core.rich_formatter import RichOperationFormatter
        from io import StringIO
        from rich.console import Console
        
        output = StringIO()
        console = Console(file=output, force_terminal=True)
        
        formatter = RichOperationFormatter()
        formatter.console = console
        
        operation_data = {
            "operation_name": "FAILING_OPERATION",
            "display_name": "Failing Operation",
            "status": "ERROR",
            "duration": 1.234,
            "error_info": {
                "type": "ValueError",
                "message": "Invalid parameter",
                "recovery_attempted": True
            }
        }
        
        formatter.format_operation_summary(operation_data)
        result = output.getvalue()
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –æ—à–∏–±–∫–∏
        assert "‚ùå ERROR" in result
        assert "‚ùå Error Details" in result
        assert "ValueError" in result
        assert "Invalid parameter" in result
        assert "üîÑ Recovery was attempted" in result
    
    def test_rich_configuration(self):
        """–¢–µ—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Rich —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é"""
        from src.core.app_settings import config_manager
        from src.core.rich_formatter import RichOperationFormatter
        
        # –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Rich
        config_manager.update_config({
            "rich_table_box": "SQUARE",
            "rich_header_style": "bold red",
            "success_icon": "üü¢",
            "error_icon": "üî¥"
        })
        
        rich_config = config_manager.get_rich_config()
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        assert rich_config.table_box_style == "SQUARE"
        assert rich_config.table_title_style == "bold red"
        assert rich_config.success_icon == "üü¢"
        assert rich_config.error_icon == "üî¥"
    
    def test_rich_fallback_mode(self):
        """–¢–µ—Å—Ç fallback —Ä–µ–∂–∏–º–∞ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–º Rich"""
        from src.core.rich_formatter import RichOperationFormatter
        from src.core.app_settings import config_manager
        
        # –û—Ç–∫–ª—é—á–∏—Ç—å Rich
        config_manager.update_config({"rich_enabled": False})
        
        formatter = RichOperationFormatter()
        
        operation_data = {
            "operation_name": "TEST_OPERATION",
            "status": "SUCCESS",
            "duration": 1.0
        }
        
        # –î–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –≤—ã–≤–æ–¥
        with patch('builtins.print') as mock_print:
            formatter.format_operation_summary(operation_data)
            
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±—ã–ª –ø—Ä–æ—Å—Ç–æ–π print, –∞ –Ω–µ Rich
        mock_print.assert_called()
        args = mock_print.call_args[0][0]
        assert isinstance(args, str)  # –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞, –Ω–µ Rich –æ–±—ä–µ–∫—Ç
    
    def test_rich_export_functionality(self):
        """–¢–µ—Å—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ Rich –≤ HTML/SVG"""
        from src.core.rich_formatter import RichOperationFormatter
        from src.core.app_settings import config_manager
        import tempfile
        import os
        
        # –í–∫–ª—é—á–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç
        config_manager.update_config({
            "rich_export_html": True,
            "rich_record_mode": True
        })
        
        formatter = RichOperationFormatter()
        
        operation_data = {
            "operation_name": "EXPORT_TEST",
            "status": "SUCCESS",
            "duration": 0.5
        }
        
        # –°–æ–∑–¥–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
        with tempfile.NamedTemporaryFile(suffix='.html', delete=False) as tmp:
            tmp_path = tmp.name
        
        try:
            # –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —ç–∫—Å–ø–æ—Ä—Ç–æ–º
            formatter.format_operation_summary(operation_data)
            
            if hasattr(formatter, 'export_html'):
                formatter.export_html(tmp_path)
                
                # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω
                assert os.path.exists(tmp_path)
                
                # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ HTML
                with open(tmp_path, 'r') as f:
                    html_content = f.read()
                    assert "EXPORT_TEST" in html_content
                    assert "SUCCESS" in html_content
        finally:
            # –û—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
            if os.path.exists(tmp_path):
                os.unlink(tmp_path)
```

### 9.8 –¢–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
```python
class TestAutoDecoration:
    """–¢–µ—Å—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤"""
    
    def test_metaclass_auto_decoration(self):
        """–¢–µ—Å—Ç –∞–≤—Ç–æ–¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ –º–µ—Ç–∞–∫–ª–∞—Å—Å"""
        from src.core.logger_handler import OperationAutoDecoratorMeta
        
        class TestOperationHandler(metaclass=OperationAutoDecoratorMeta):
            def add_reaction(self):
                return "reaction_added"
            
            def remove_reaction(self):
                return "reaction_removed"
            
            def non_operation_method(self):
                return "not_decorated"
        
        handler = TestOperationHandler()
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω—ã
        assert hasattr(handler.add_reaction, '_operation_decorated')
        assert hasattr(handler.remove_reaction, '_operation_decorated')
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–±—ã—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –Ω–µ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω—ã
        assert not hasattr(handler.non_operation_method, '_operation_decorated')
    
    def test_auto_decoration_validation(self):
        """–¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∞–≤—Ç–æ–¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è"""
        from src.core.logger_handler import AutoDecorationValidator
        
        class ValidatedHandler(OperationAutoDecoratorMeta):
            def add_reaction(self):
                pass
            
            def load_file(self):
                pass
        
        warnings = AutoDecorationValidator.validate_decorated_class(ValidatedHandler)
        
        # –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞
        assert len(warnings) == 0
```

### 9.9 –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```python
class TestPerformance:
    """–¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è"""
    
    def test_decorator_overhead(self):
        """–¢–µ—Å—Ç –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞"""
        import time
        
        # –§—É–Ω–∫—Ü–∏—è –±–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞
        def plain_function():
            return sum(range(1000))
        
        # –§—É–Ω–∫—Ü–∏—è —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º
        @operation
        def decorated_function():
            return sum(range(1000))
        
        # –ò–∑–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
        iterations = 1000
        
        # –ë–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞
        start = time.time()
        for _ in range(iterations):
            plain_function()
        plain_time = time.time() - start
        
        # –° –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º
        start = time.time()
        for _ in range(iterations):
            decorated_function()
        decorated_time = time.time() - start
        
        # –ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –ø—Ä–µ–≤—ã—à–∞—Ç—å 50%
        overhead = (decorated_time - plain_time) / plain_time
        assert overhead < 0.5, f"Decorator overhead too high: {overhead:.2%}"
    
    def test_concurrent_operations(self):
        """–¢–µ—Å—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π"""
        import threading
        import time
        
        def operation_worker(worker_id, iterations):
            for i in range(iterations):
                @operation
                def worker_operation():
                    time.sleep(0.001)  # –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞
                    return f"worker_{worker_id}_iteration_{i}"
                
                worker_operation()
        
        # –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–±–æ—á–∏—Ö –ø–æ—Ç–æ–∫–æ–≤
        workers = []
        start_time = time.time()
        
        for worker_id in range(10):
            worker = threading.Thread(
                target=operation_worker,
                args=(worker_id, 50)
            )
            workers.append(worker)
            worker.start()
        
        # –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        for worker in workers:
            worker.join()
        
        total_time = time.time() - start_time
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–∑—É–º–Ω–æ–µ
        assert total_time < 30, f"Concurrent operations took too long: {total_time:.2f}s"
    
    def test_memory_usage(self):
        """–¢–µ—Å—Ç –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏"""
        import psutil
        import os
        
        process = psutil.Process(os.getpid())
        initial_memory = process.memory_info().rss
        
        # –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–Ω–æ–≥–æ –æ–ø–µ—Ä–∞—Ü–∏–π
        for i in range(1000):
            @operation
            def memory_test_operation():
                data = list(range(1000))  # –°–æ–∑–¥–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
                return len(data)
            
            memory_test_operation()
        
        final_memory = process.memory_info().rss
        memory_increase = final_memory - initial_memory
        
        # –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º
        assert memory_increase < 50 * 1024 * 1024, f"Memory increase too high: {memory_increase / 1024 / 1024:.2f}MB"
```

### 9.10 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```python
class TestIntegration:
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å–∏—Å—Ç–µ–º—ã"""
    
    def test_full_operation_workflow(self):
        """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏"""
        from src.core.calculation_data_operations import CalculationDataOperations
        from src.core.app_settings import config_manager
        
        # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        config_manager.update_config({
            "ascii_tables_enabled": True,
            "detail_level": "detailed"
        })
        
        # –°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ–ø–µ—Ä–∞—Ü–∏–π
        operations = CalculationDataOperations()
        
        # –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω–∞)
        with patch('builtins.print') as mock_print:
            result = operations.add_reaction(
                file_name="test.csv",
                reaction_data={"function": "gauss"}
            )
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞
        assert result is not None
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ –±—ã–ª–∞ –≤—ã–≤–µ–¥–µ–Ω–∞
        mock_print.assert_called()
        table_output = mock_print.call_args[0][0]
        assert "OPERATION SUMMARY" in table_output
        assert "Add Reaction" in table_output
    
    def test_error_recovery_workflow(self):
        """–¢–µ—Å—Ç —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º –ø–æ—Å–ª–µ –æ—à–∏–±–æ–∫"""
        from src.core.logger_handler import get_operation_logger
        from src.core.error_handlers import GuiOperationErrorHandler
        
        # –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
        logger = get_operation_logger()
        error_handler = GuiOperationErrorHandler()
        logger.register_error_handler(error_handler)
        
        # –í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é —Å –æ—à–∏–±–∫–æ–π
        @operation
        def failing_operation():
            raise ValueError("Intentional test error")
        
        with pytest.raises(ValueError):
            failing_operation()
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –±—ã–ª –≤—ã–∑–≤–∞–Ω
        # (–∑–¥–µ—Å—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ mock –∏–ª–∏ –ª–æ–≥–∏)
```

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏

### 9.11 –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- ‚úÖ –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–µ–∫–æ—Ä–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –í–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∞–≥—Ä–µ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –û—à–∏–±–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏

### 9.12 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- ‚úÖ –ù–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ < 50%
- ‚úÖ –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è 1000 –æ–ø–µ—Ä–∞—Ü–∏–π < 30 —Å–µ–∫—É–Ω–¥
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ < 50MB –ø—Ä–∏ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ –º–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥–µ

### 9.13 –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ > 90%
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 9.14 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
```python
# pytest.ini
[tool:pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = 
    --verbose
    --cov=src.core.logger_handler
    --cov-report=html
    --cov-report=term-missing
    --cov-fail-under=90
markers =
    integration: marks tests as integration tests
    performance: marks tests as performance tests
    slow: marks tests as slow running
```

### 9.15 –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```yaml
# .github/workflows/test.yml
name: Test Logger Handler Refactor

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.9, 3.10, 3.11]
    
    steps:
    - uses: actions/checkout@v3
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v3
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pytest pytest-cov pytest-mock
        pip install -r requirements.txt
    
    - name: Run tests
      run: |
        pytest tests/ --cov=src.core.logger_handler --cov-report=xml
    
    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v1
```

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- –ü–æ–ª–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- –ù–∞–±–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –∫–æ–¥–æ–º

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏
- –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
- –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ —Ç–µ—Å—Ç–∞–º–∏ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 90%
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
- –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –°–æ–∑–¥–∞–Ω–∏–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ –∑–∞–ø—É—Å–∫—É —Ç–µ—Å—Ç–æ–≤
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—é –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤
- –û—Ç—á—ë—Ç—ã –æ –ø–æ–∫—Ä—ã—Ç–∏–∏ –∫–æ–¥–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
