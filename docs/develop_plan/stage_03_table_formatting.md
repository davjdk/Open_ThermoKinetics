# Этап 3: Форматирование и вывод таблиц

## Цель этапа
Реализовать форматирование агрегированных логов операций с использованием библиотеки `tabulate`.

## Задачи

### 3.1 Создание форматтера таблиц
- Создать класс `OperationTableFormatter`
- Реализовать методы для форматирования:
  - Заголовка операции
  - Таблицы подопераций
  - Резюме операции
  - Блока ошибок (если есть)

### 3.2 Структура таблицы подопераций
- Определить колонки таблицы:
  - Шаг (номер по порядку)
  - Подоперация (название/тип)
  - Цель (целевой компонент)
  - Тип данных результата
  - Статус (OK/Error)
  - Время выполнения (в секундах)
- Настроить выравнивание колонок через `tabulate`

### 3.3 Форматирование заголовка операции
- Шаблон заголовка:
  ```
  Операция "OPERATION_NAME" – НАЧАЛО (id=1234, 2025-06-15 14:06:38)
  ```
- Генерация уникального ID операции
- Форматирование времени в читаемом виде

### 3.4 Резюме операции
- Формирование итогового блока:
  - Общее количество шагов
  - Количество успешных операций
  - Количество операций с ошибками
  - Общее время выполнения
- Шаблон:
  ```
  ИТОГО: шагов X, успешно Y, с ошибками Z, общее время T с.
  Операция "OPERATION_NAME" – ЗАВЕРШЕНО (статус: успешно/с ошибкой)
  ```

### 3.5 Обработка ошибок в форматировании
- Обработка случаев с пустым списком подопераций
- Форматирование информации об исключениях
- Ограничение длины сообщений об ошибках
- Экранирование специальных символов

### 3.6 Конфигурация tabulate
- Выбор стиля таблицы (grid, plain, simple)
- Настройка выравнивания для каждой колонки
- Обработка длинных строк (обрезка/перенос)

## Критерии готовности
- [ ] Агрегированные логи выводятся в читаемом табличном формате
- [ ] Заголовки операций содержат всю необходимую информацию
- [ ] Таблица подопераций корректно отформатирована
- [ ] Резюме содержит точную статистику
- [ ] Обрабатываются крайние случаи (нет подопераций, только ошибки)
- [ ] Форматирование устойчиво к некорректным данным

## Файлы для создания/изменения
- `src/core/log_aggregator/table_formatter.py`
- `src/core/log_aggregator/operation_logger.py` (интеграция форматтера)

## Примечания
Рекомендации по форматированию:
- Использовать формат 'grid' для наглядности
- Ограничить ширину колонок для читаемости
- Добавить визуальные разделители между операциями
- Предусмотреть локализацию (но не реализовывать в MVP)
